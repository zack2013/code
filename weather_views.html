<!DOCTYPE html>
<html lang="en">
<head>
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我的第一个天气预报程序</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
    </script>
    <script>
        $(document).ready(function(){
            $("#button1").click(function(){
                $.ajax({
                    url:"https://saweather.market.alicloudapi.com/spot-to-weather",
                    headers: {
                          "Authorization": "APPCODE 7300b3927fdb407ab4af4761b27912a8"
                        },
                    data: {
                            "area": $("#locationText").val() || '嘉定',
                            "need3HourForcast": "0",
                            "needAlarm": "0",
                            "needHourData": "0",
                            "needIndex": "0",
                            "needMoreDay": "0"
                        },
                    success:function(result){
                        var obj =eval(result);
                        $("#cityName").text(obj.showapi_res_body.cityInfo.c5);
                        $("#districtName").text(obj.showapi_res_body.cityInfo.c3);
                        $("#highTemp").text(obj.showapi_res_body.f1.day_air_temperature);
                        $("#lowTemp").text(obj.showapi_res_body.f1.night_air_temperature);
                        $("#weatherInfo").text(obj.showapi_res_body.f1.night_weather);
                    },
                    dataType: 'json'
                })
            })
        })
    </script>
    <script>
    $(document).ready(function(){
        var res = $.ajax({url:"/status?visitors",async:false}).responseText;
        var visitors = eval(res);
        $("#visitors-data").text(visitors);
    });
    </script>
</head>
<body>
    <p>请输入城市/景区名称</p>
    <input type="text" name="输入地点" id="locationText"><br>
    <button id="button1" value="">提交以查看天气</button>

    <p>
        <b>天气查询结果<b><br>
        城市：<span id="cityName"></span><span id="districtName"></span><br>
        今天最高气温：<span id="highTemp"></span><span>度</span><br>
        今天最低气温：<span id="lowTemp"></span><span>度</span><br>
        天气状况：<span id="weatherInfo"></span>
    </p>
    <br>
    <div id="status">
        <p>今日访客数量：<span id= "visitors-data"></span></p>
    </div>
</body>
</html>
